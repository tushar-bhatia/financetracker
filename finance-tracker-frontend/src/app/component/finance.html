<div class="app-container">
  <header class="app-header" [ngClass]="{ 'shrink': isShrink }">
    <div class="logo-title">
      <img ngSrc="assets/logo.png" alt="Finance Tracker Logo" class="logo" height="1024" width="1024"/>
      <h1>Finance Tracker</h1>
    </div>
    <div class="summary">
      <div class="summary-item">
        <div class="label">Total Balance</div>
        <div class="value">{{ balance | currency:'INR':'symbol' }}</div>
      </div>
      <div class="summary-item small">
        <div class="label">Income</div>
        <div class="value income">{{ totalIncome | currency:'INR':'symbol' }}</div>
      </div>
      <div class="summary-item small">
        <div class="label">Expense</div>
        <div class="value expense">{{ totalExpense | currency:'INR':'symbol' }}</div>
      </div>
    </div>
  </header>

  <section class="controls">
    <h2 class="filter-title">Transaction Filters</h2>

    <div class="filters-row">

      <!-- Category Filter -->
      <div class="filter-field">
        <label for="category-select">Category</label>
        <select id="category-select" [(ngModel)]="selectedCategory" (change)="applyFilters()">
          <option value="">All Categories</option>
          <option *ngFor="let cat of categoryData" [value]="cat.name">{{ cat.name }}</option>
        </select>
      </div>

      <!-- Type Filter -->
      <div class="filter-field">
        <label for="type-select">Type</label>
        <select id="type-select" [(ngModel)]="selectedType" (change)="applyFilters()">
          <option value="">All Transaction Types</option>
          <option value="INCOME">Income</option>
          <option value="EXPENSE">Expense</option>
        </select>
      </div>

      <!-- Date Filters -->
      <div class="date-filter-field">
        <label for="from-date">From</label>
        <input type="date" id="from-date" [(ngModel)]="fromDate" (change)="applyFilters()" />
      </div>
      <span class="dash">â€”</span>
      <div class="date-filter-field">
        <label for="to-date">To</label>
        <input type="date" id="to-date" [(ngModel)]="toDate" (change)="applyFilters()" />
      </div>

    </div>
  </section>

  <main>
    <div *ngIf="loading" class="loading">Loading transactions...</div>
    <div *ngIf="loading && filteredTransactions.length === 0" class="empty">No transactions found.</div>

    <!-- Desktop Table -->
    <table class="tx-table" *ngIf="!loading && filteredTransactions.length > 0">
      <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Category</th>
        <th class="amount-col">Amount</th>
        <th>Type</th>
        <th class="actions-col">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let tx of filteredTransactions">
        <td>{{ tx.transactionDate | date:'mediumDate' }}</td>
        <td>{{ tx.description }}</td>
        <td>{{ tx.category?.name }}</td>
        <td class="amount-col">{{ tx.amount | currency:'INR':'symbol' }}</td>
        <td>
            <span class="badge" [ngClass]="{income: tx.transactionType === 'INCOME', expense: tx.transactionType === 'EXPENSE'}">
              {{ tx.transactionType }}
            </span>
        </td>
        <td class="actions-col">
          <button mat-icon-button class="edit-icon" (click)="onEdit(tx)">
            <mat-icon fontSet="material-icons-outlined">edit</mat-icon>
          </button>
          <button mat-icon-button class="delete-icon" (click)="onDelete(tx)">
            <mat-icon fontSet="material-icons-outlined">delete</mat-icon>
          </button>
        </td>
      </tr>
      </tbody>
    </table>

    <!-- Mobile Card View -->
    <div class="card-list" *ngIf="loading && filteredTransactions.length > 0">
      <article class="tx-card" *ngFor="let tx of transactions">
        <div class="card-row top">
          <div class="date">{{ tx.transactionDate | date:'mediumDate' }}</div>
          <div class="amount">{{ tx.amount | currency:'INR':'symbol' }}</div>
        </div>
        <div class="card-row">
          <div class="desc">{{ tx.description }}</div>
        </div>
        <div class="card-row bottom">
          <div class="category">{{ tx.category.name }}</div>
          <div class="type">
            <span class="badge" [ngClass]="{income: tx.transactionType === 'INCOME', expense: tx.transactionType === 'EXPENSE'}">
              {{ tx.transactionType }}
            </span>
          </div>
        </div>
        <div class="card-row actions">
          <button mat-icon-button class="edit-icon" (click)="onEdit(tx)" [disableRipple]="false">
            <mat-icon fontSet="material-icons-outlined">edit</mat-icon>
          </button>
          <button mat-icon-button class="delete-icon" (click)="onDelete(tx)" [disableRipple]="false">
            <mat-icon fontSet="material-icons-outlined">delete</mat-icon>
          </button>
        </div>
      </article>
    </div>
  </main>
</div>
